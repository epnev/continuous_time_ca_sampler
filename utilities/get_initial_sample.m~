function SAM = get_initial_sample(Y,params,c)

% obtain initial sample by performing sparse noise-constrained deconvolution
% Author: Eftychios A. Pnevm

if nargin == 2
    [c,b,c1,g,sn,sp] = constrained_foopsi(Y,params.b,params.c1,params.g,params.sn);
end

Dt = 1;
T = length(Y);
if ~exist('sp','var')
    G = make_G_matrix(T,params.g);
    sp = G*c;
end
s_in = sp>0.15*max(sp);
spiketimes_ = Dt*(find(s_in) + rand(size(find(s_in))) - 0.5);
spiketimes_(spiketimes_ >= T*Dt) = 2*T*Dt - spiketimes_(spiketimes_ >= T*Dt);
SAM.lam_ = length(spiketimes_)/(T*Dt);
SAM.spiketimes_ = spiketimes_;

SAM.A_   = max(median(sp(s_in)),0.11);             % initial amplitude value
SAM.b_   = max(b,0.025);                           % initial baseline value'
SAM.C_in = max(c1,1e-3);                           % initial value sample
SAM.sg = sn;                                       % initial noise value
SAM.g = g;                                         % initial time constant value